{"ast":null,"code":"\"use strict\";\n\nvar __classPrivateFieldSet = this && this.__classPrivateFieldSet || function (receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value), value;\n};\nvar __classPrivateFieldGet = this && this.__classPrivateFieldGet || function (receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\nvar _GuardManager_ethAdapter, _GuardManager_safeContract, _GuardManager_slot;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nconst safe_core_sdk_utils_1 = require(\"@safe-global/safe-core-sdk-utils\");\nconst utils_1 = require(\"../utils\");\nconst constants_1 = require(\"../utils/constants\");\nclass GuardManager {\n  constructor(ethAdapter, safeContract) {\n    _GuardManager_ethAdapter.set(this, void 0);\n    _GuardManager_safeContract.set(this, void 0);\n    // keccak256(\"guard_manager.guard.address\")\n    _GuardManager_slot.set(this, '0x4a204f620c8c5ccdca3fd54d003badd85ba500436a431f0cbda4f558c93c34c8');\n    __classPrivateFieldSet(this, _GuardManager_ethAdapter, ethAdapter, \"f\");\n    __classPrivateFieldSet(this, _GuardManager_safeContract, safeContract, \"f\");\n  }\n  validateGuardAddress(guardAddress) {\n    const isValidAddress = __classPrivateFieldGet(this, _GuardManager_ethAdapter, \"f\").isAddress(guardAddress);\n    if (!isValidAddress || (0, utils_1.isZeroAddress)(guardAddress)) {\n      throw new Error('Invalid guard address provided');\n    }\n  }\n  validateGuardIsNotEnabled(currentGuard, newGuardAddress) {\n    if ((0, utils_1.sameString)(currentGuard, newGuardAddress)) {\n      throw new Error('Guard provided is already enabled');\n    }\n  }\n  validateGuardIsEnabled(guardAddress) {\n    if ((0, utils_1.isZeroAddress)(guardAddress)) {\n      throw new Error('There is no guard enabled yet');\n    }\n  }\n  async getGuard() {\n    const safeVersion = await __classPrivateFieldGet(this, _GuardManager_safeContract, \"f\").getVersion();\n    if ((0, safe_core_sdk_utils_1.hasSafeFeature)(safe_core_sdk_utils_1.SAFE_FEATURES.SAFE_TX_GUARDS, safeVersion)) {\n      return __classPrivateFieldGet(this, _GuardManager_ethAdapter, \"f\").getStorageAt(__classPrivateFieldGet(this, _GuardManager_safeContract, \"f\").getAddress(), __classPrivateFieldGet(this, _GuardManager_slot, \"f\"));\n    } else {\n      throw new Error('Current version of the Safe does not support Safe transaction guards functionality');\n    }\n  }\n  async encodeEnableGuardData(guardAddress) {\n    this.validateGuardAddress(guardAddress);\n    const currentGuard = await this.getGuard();\n    this.validateGuardIsNotEnabled(currentGuard, guardAddress);\n    return __classPrivateFieldGet(this, _GuardManager_safeContract, \"f\").encode('setGuard', [guardAddress]);\n  }\n  async encodeDisableGuardData() {\n    const currentGuard = await this.getGuard();\n    this.validateGuardIsEnabled(currentGuard);\n    return __classPrivateFieldGet(this, _GuardManager_safeContract, \"f\").encode('setGuard', [constants_1.ZERO_ADDRESS]);\n  }\n}\n_GuardManager_ethAdapter = new WeakMap(), _GuardManager_safeContract = new WeakMap(), _GuardManager_slot = new WeakMap();\nexports.default = GuardManager;","map":{"version":3,"names":["safe_core_sdk_utils_1","require","utils_1","constants_1","GuardManager","constructor","ethAdapter","safeContract","_GuardManager_ethAdapter","set","_GuardManager_safeContract","_GuardManager_slot","__classPrivateFieldSet","validateGuardAddress","guardAddress","isValidAddress","__classPrivateFieldGet","isAddress","isZeroAddress","Error","validateGuardIsNotEnabled","currentGuard","newGuardAddress","sameString","validateGuardIsEnabled","getGuard","safeVersion","getVersion","hasSafeFeature","SAFE_FEATURES","SAFE_TX_GUARDS","getStorageAt","getAddress","encodeEnableGuardData","encode","encodeDisableGuardData","ZERO_ADDRESS","exports","default"],"sources":["../../../src/managers/guardManager.ts"],"sourcesContent":[null],"mappings":";;;;;;;;;;;;;;;;;AACA,MAAAA,qBAAA,GAAAC,OAAA;AACA,MAAAC,OAAA,GAAAD,OAAA;AACA,MAAAE,WAAA,GAAAF,OAAA;AAEA,MAAMG,YAAY;EAMhBC,YAAYC,UAAsB,EAAEC,YAAgC;IALpEC,wBAAA,CAAAC,GAAA;IACAC,0BAAA,CAAAD,GAAA;IACA;IACAE,kBAAA,CAAAF,GAAA,OAAQ,oEAAoE;IAG1EG,sBAAA,KAAI,EAAAJ,wBAAA,EAAeF,UAAU;IAC7BM,sBAAA,KAAI,EAAAF,0BAAA,EAAiBH,YAAY;EACnC;EAEQM,oBAAoBA,CAACC,YAAoB;IAC/C,MAAMC,cAAc,GAAGC,sBAAA,KAAI,EAAAR,wBAAA,MAAY,CAACS,SAAS,CAACH,YAAY,CAAC;IAC/D,IAAI,CAACC,cAAc,IAAI,IAAAb,OAAA,CAAAgB,aAAa,EAACJ,YAAY,CAAC,EAAE;MAClD,MAAM,IAAIK,KAAK,CAAC,gCAAgC,CAAC;;EAErD;EAEQC,yBAAyBA,CAACC,YAAoB,EAAEC,eAAuB;IAC7E,IAAI,IAAApB,OAAA,CAAAqB,UAAU,EAACF,YAAY,EAAEC,eAAe,CAAC,EAAE;MAC7C,MAAM,IAAIH,KAAK,CAAC,mCAAmC,CAAC;;EAExD;EAEQK,sBAAsBA,CAACV,YAAoB;IACjD,IAAI,IAAAZ,OAAA,CAAAgB,aAAa,EAACJ,YAAY,CAAC,EAAE;MAC/B,MAAM,IAAIK,KAAK,CAAC,+BAA+B,CAAC;;EAEpD;EAEA,MAAMM,QAAQA,CAAA;IACZ,MAAMC,WAAW,GAAG,MAAMV,sBAAA,KAAI,EAAAN,0BAAA,MAAc,CAACiB,UAAU,EAAE;IACzD,IAAI,IAAA3B,qBAAA,CAAA4B,cAAc,EAAC5B,qBAAA,CAAA6B,aAAa,CAACC,cAAc,EAAEJ,WAAW,CAAC,EAAE;MAC7D,OAAOV,sBAAA,KAAI,EAAAR,wBAAA,MAAY,CAACuB,YAAY,CAACf,sBAAA,KAAI,EAAAN,0BAAA,MAAc,CAACsB,UAAU,EAAE,EAAEhB,sBAAA,KAAI,EAAAL,kBAAA,MAAM,CAAC;KAClF,MAAM;MACL,MAAM,IAAIQ,KAAK,CACb,oFAAoF,CACrF;;EAEL;EAEA,MAAMc,qBAAqBA,CAACnB,YAAoB;IAC9C,IAAI,CAACD,oBAAoB,CAACC,YAAY,CAAC;IACvC,MAAMO,YAAY,GAAG,MAAM,IAAI,CAACI,QAAQ,EAAE;IAC1C,IAAI,CAACL,yBAAyB,CAACC,YAAY,EAAEP,YAAY,CAAC;IAC1D,OAAOE,sBAAA,KAAI,EAAAN,0BAAA,MAAc,CAACwB,MAAM,CAAC,UAAU,EAAE,CAACpB,YAAY,CAAC,CAAC;EAC9D;EAEA,MAAMqB,sBAAsBA,CAAA;IAC1B,MAAMd,YAAY,GAAG,MAAM,IAAI,CAACI,QAAQ,EAAE;IAC1C,IAAI,CAACD,sBAAsB,CAACH,YAAY,CAAC;IACzC,OAAOL,sBAAA,KAAI,EAAAN,0BAAA,MAAc,CAACwB,MAAM,CAAC,UAAU,EAAE,CAAC/B,WAAA,CAAAiC,YAAY,CAAC,CAAC;EAC9D;;;AAGFC,OAAA,CAAAC,OAAA,GAAelC,YAAY"},"metadata":{},"sourceType":"script","externalDependencies":[]}