{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.estimateTxGas = void 0;\nconst bignumber_1 = require(\"@ethersproject/bignumber\");\nconst safe_core_sdk_types_1 = require(\"@safe-global/safe-core-sdk-types\");\nfunction estimateDataGasCosts(data) {\n  const reducer = (accumulator, currentValue) => {\n    if (currentValue === '0x') {\n      return accumulator + 0;\n    }\n    if (currentValue === '00') {\n      return accumulator + 4;\n    }\n    return accumulator + 16;\n  };\n  return data.match(/.{2}/g).reduce(reducer, 0);\n}\nasync function estimateTxGas(safeContract, ethAdapter, to, valueInWei, data, operation) {\n  let txGasEstimation = 0;\n  const safeAddress = safeContract.getAddress();\n  const estimateData = safeContract.encode('requiredTxGas', [to, valueInWei, data, operation]);\n  try {\n    const estimateResponse = (await ethAdapter.estimateGas({\n      to: safeAddress,\n      from: safeAddress,\n      data: estimateData\n    })).toString();\n    txGasEstimation = bignumber_1.BigNumber.from('0x' + estimateResponse.substring(138)).toNumber() + 10000;\n  } catch (error) {}\n  if (txGasEstimation > 0) {\n    const dataGasEstimation = estimateDataGasCosts(estimateData);\n    let additionalGas = 10000;\n    for (let i = 0; i < 10; i++) {\n      try {\n        const estimateResponse = await ethAdapter.call({\n          to: safeAddress,\n          from: safeAddress,\n          data: estimateData,\n          gasPrice: 0,\n          gasLimit: txGasEstimation + dataGasEstimation + additionalGas\n        });\n        if (estimateResponse !== '0x') {\n          break;\n        }\n      } catch (error) {}\n      txGasEstimation += additionalGas;\n      additionalGas *= 2;\n    }\n    return txGasEstimation + additionalGas;\n  }\n  try {\n    const estimateGas = await ethAdapter.estimateGas({\n      to,\n      from: safeAddress,\n      value: valueInWei,\n      data\n    });\n    return estimateGas;\n  } catch (error) {\n    if (operation === safe_core_sdk_types_1.OperationType.DelegateCall) {\n      return 0;\n    }\n    return Promise.reject(error);\n  }\n}\nexports.estimateTxGas = estimateTxGas;","map":{"version":3,"names":["bignumber_1","require","safe_core_sdk_types_1","estimateDataGasCosts","data","reducer","accumulator","currentValue","match","reduce","estimateTxGas","safeContract","ethAdapter","to","valueInWei","operation","txGasEstimation","safeAddress","getAddress","estimateData","encode","estimateResponse","estimateGas","from","toString","BigNumber","substring","toNumber","error","dataGasEstimation","additionalGas","i","call","gasPrice","gasLimit","value","OperationType","DelegateCall","Promise","reject","exports"],"sources":["../../../../src/utils/transactions/gas.ts"],"sourcesContent":[null],"mappings":";;;;;;AAAA,MAAAA,WAAA,GAAAC,OAAA;AACA,MAAAC,qBAAA,GAAAD,OAAA;AAEA,SAASE,oBAAoBA,CAACC,IAAY;EACxC,MAAMC,OAAO,GAAGA,CAACC,WAAmB,EAAEC,YAAoB,KAAI;IAC5D,IAAIA,YAAY,KAAK,IAAI,EAAE;MACzB,OAAOD,WAAW,GAAG,CAAC;;IAExB,IAAIC,YAAY,KAAK,IAAI,EAAE;MACzB,OAAOD,WAAW,GAAG,CAAC;;IAExB,OAAOA,WAAW,GAAG,EAAE;EACzB,CAAC;EACD,OAAQF,IAAI,CAACI,KAAK,CAAC,OAAO,CAAc,CAACC,MAAM,CAACJ,OAAO,EAAE,CAAC,CAAC;AAC7D;AAEO,eAAeK,aAAaA,CACjCC,YAAgC,EAChCC,UAAsB,EACtBC,EAAU,EACVC,UAAkB,EAClBV,IAAY,EACZW,SAAwB;EAExB,IAAIC,eAAe,GAAG,CAAC;EACvB,MAAMC,WAAW,GAAGN,YAAY,CAACO,UAAU,EAAE;EAE7C,MAAMC,YAAY,GAAWR,YAAY,CAACS,MAAM,CAAC,eAAe,EAAE,CAChEP,EAAE,EACFC,UAAU,EACVV,IAAI,EACJW,SAAS,CACV,CAAC;EACF,IAAI;IACF,MAAMM,gBAAgB,GAAG,CACvB,MAAMT,UAAU,CAACU,WAAW,CAAC;MAC3BT,EAAE,EAAEI,WAAW;MACfM,IAAI,EAAEN,WAAW;MACjBb,IAAI,EAAEe;KACP,CAAC,EACFK,QAAQ,EAAE;IACZR,eAAe,GAAGhB,WAAA,CAAAyB,SAAS,CAACF,IAAI,CAAC,IAAI,GAAGF,gBAAgB,CAACK,SAAS,CAAC,GAAG,CAAC,CAAC,CAACC,QAAQ,EAAE,GAAG,KAAK;GAC5F,CAAC,OAAOC,KAAK,EAAE;EAEhB,IAAIZ,eAAe,GAAG,CAAC,EAAE;IACvB,MAAMa,iBAAiB,GAAG1B,oBAAoB,CAACgB,YAAY,CAAC;IAC5D,IAAIW,aAAa,GAAG,KAAK;IACzB,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,EAAE,EAAEA,CAAC,EAAE,EAAE;MAC3B,IAAI;QACF,MAAMV,gBAAgB,GAAG,MAAMT,UAAU,CAACoB,IAAI,CAAC;UAC7CnB,EAAE,EAAEI,WAAW;UACfM,IAAI,EAAEN,WAAW;UACjBb,IAAI,EAAEe,YAAY;UAClBc,QAAQ,EAAE,CAAC;UACXC,QAAQ,EAAElB,eAAe,GAAGa,iBAAiB,GAAGC;SACjD,CAAC;QACF,IAAIT,gBAAgB,KAAK,IAAI,EAAE;UAC7B;;OAEH,CAAC,OAAOO,KAAK,EAAE;MAChBZ,eAAe,IAAIc,aAAa;MAChCA,aAAa,IAAI,CAAC;;IAEpB,OAAOd,eAAe,GAAGc,aAAa;;EAGxC,IAAI;IACF,MAAMR,WAAW,GAAG,MAAMV,UAAU,CAACU,WAAW,CAAC;MAC/CT,EAAE;MACFU,IAAI,EAAEN,WAAW;MACjBkB,KAAK,EAAErB,UAAU;MACjBV;KACD,CAAC;IACF,OAAOkB,WAAW;GACnB,CAAC,OAAOM,KAAK,EAAE;IACd,IAAIb,SAAS,KAAKb,qBAAA,CAAAkC,aAAa,CAACC,YAAY,EAAE;MAC5C,OAAO,CAAC;;IAEV,OAAOC,OAAO,CAACC,MAAM,CAACX,KAAK,CAAC;;AAEhC;AAhEAY,OAAA,CAAA9B,aAAA,GAAAA,aAAA"},"metadata":{},"sourceType":"script","externalDependencies":[]}