{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.DeterministicDeployer = void 0;\nconst ethers_1 = require(\"ethers\");\nconst utils_1 = require(\"ethers/lib/utils\");\n/**\n * wrapper class for Arachnid's deterministic deployer\n * (deterministic deployer used by 'hardhat-deployer'. generates the same addresses as \"hardhat-deploy\")\n */\nclass DeterministicDeployer {\n  static getAddress(ctrCode, salt = 0, params = []) {\n    return DeterministicDeployer.getDeterministicDeployAddress(ctrCode, salt, params);\n  }\n  static async deploy(ctrCode, salt = 0, params = []) {\n    return await DeterministicDeployer.instance.deterministicDeploy(ctrCode, salt, params);\n  }\n  constructor(provider) {\n    this.provider = provider;\n  }\n  async isContractDeployed(address) {\n    return await this.provider.getCode(address).then(code => code.length > 2);\n  }\n  async isDeployerDeployed() {\n    return await this.isContractDeployed(DeterministicDeployer.proxyAddress);\n  }\n  async deployFactory() {\n    if (await this.isContractDeployed(DeterministicDeployer.proxyAddress)) {\n      return;\n    }\n    const bal = await this.provider.getBalance(DeterministicDeployer.deploymentSignerAddress);\n    const neededBalance = ethers_1.BigNumber.from(DeterministicDeployer.deploymentGasLimit).mul(DeterministicDeployer.deploymentGasPrice);\n    const signer = this.provider.getSigner();\n    if (bal.lt(neededBalance)) {\n      await signer.sendTransaction({\n        to: DeterministicDeployer.deploymentSignerAddress,\n        value: neededBalance,\n        gasLimit: DeterministicDeployer.deploymentGasLimit\n      });\n    }\n    await this.provider.send('eth_sendRawTransaction', [DeterministicDeployer.deploymentTransaction]);\n    if (!(await this.isContractDeployed(DeterministicDeployer.proxyAddress))) {\n      throw new Error('raw TX didn\\'t deploy deployer!');\n    }\n  }\n  async getDeployTransaction(ctrCode, salt = 0, params = []) {\n    await this.deployFactory();\n    const saltEncoded = (0, utils_1.hexZeroPad)((0, utils_1.hexlify)(salt), 32);\n    const ctrEncoded = DeterministicDeployer.getCtrCode(ctrCode, params);\n    return {\n      to: DeterministicDeployer.proxyAddress,\n      data: (0, utils_1.hexConcat)([saltEncoded, ctrEncoded])\n    };\n  }\n  static getCtrCode(ctrCode, params) {\n    if (typeof ctrCode !== 'string') {\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      return (0, utils_1.hexlify)(ctrCode.getDeployTransaction(...params).data);\n    } else {\n      if (params.length !== 0) {\n        throw new Error('constructor params can only be passed to ContractFactory');\n      }\n      return ctrCode;\n    }\n  }\n  static getDeterministicDeployAddress(ctrCode, salt = 0, params = []) {\n    // this method works only before the contract is already deployed:\n    // return await this.provider.call(await this.getDeployTransaction(ctrCode, salt))\n    const saltEncoded = (0, utils_1.hexZeroPad)((0, utils_1.hexlify)(salt), 32);\n    const ctrCode1 = DeterministicDeployer.getCtrCode(ctrCode, params);\n    return '0x' + (0, utils_1.keccak256)((0, utils_1.hexConcat)(['0xff', DeterministicDeployer.proxyAddress, saltEncoded, (0, utils_1.keccak256)(ctrCode1)])).slice(-40);\n  }\n  async deterministicDeploy(ctrCode, salt = 0, params = []) {\n    const addr = DeterministicDeployer.getDeterministicDeployAddress(ctrCode, salt, params);\n    if (!(await this.isContractDeployed(addr))) {\n      await this.provider.getSigner().sendTransaction(await this.getDeployTransaction(ctrCode, salt, params));\n    }\n    return addr;\n  }\n  static init(provider) {\n    this._instance = new DeterministicDeployer(provider);\n  }\n  static get instance() {\n    if (this._instance == null) {\n      throw new Error('must call \"DeterministicDeployer.init(ethers.provider)\" first');\n    }\n    return this._instance;\n  }\n}\nexports.DeterministicDeployer = DeterministicDeployer;\n// from: https://github.com/Arachnid/deterministic-deployment-proxy\nDeterministicDeployer.proxyAddress = '0x4e59b44847b379578588920ca78fbf26c0b4956c';\nDeterministicDeployer.deploymentTransaction = '0xf8a58085174876e800830186a08080b853604580600e600039806000f350fe7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe03601600081602082378035828234f58015156039578182fd5b8082525050506014600cf31ba02222222222222222222222222222222222222222222222222222222222222222a02222222222222222222222222222222222222222222222222222222222222222';\nDeterministicDeployer.deploymentSignerAddress = '0x3fab184622dc19b6109349b94811493bf2a45362';\nDeterministicDeployer.deploymentGasPrice = 100e9;\nDeterministicDeployer.deploymentGasLimit = 100000;","map":{"version":3,"names":["ethers_1","require","utils_1","DeterministicDeployer","getAddress","ctrCode","salt","params","getDeterministicDeployAddress","deploy","instance","deterministicDeploy","constructor","provider","isContractDeployed","address","getCode","then","code","length","isDeployerDeployed","proxyAddress","deployFactory","bal","getBalance","deploymentSignerAddress","neededBalance","BigNumber","from","deploymentGasLimit","mul","deploymentGasPrice","signer","getSigner","lt","sendTransaction","to","value","gasLimit","send","deploymentTransaction","Error","getDeployTransaction","saltEncoded","hexZeroPad","hexlify","ctrEncoded","getCtrCode","data","hexConcat","ctrCode1","keccak256","slice","addr","init","_instance","exports"],"sources":["../../src/DeterministicDeployer.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}