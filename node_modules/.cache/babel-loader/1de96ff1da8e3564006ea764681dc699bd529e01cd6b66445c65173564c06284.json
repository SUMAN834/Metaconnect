{"ast":null,"code":"\"use strict\";\n\nvar __classPrivateFieldSet = this && this.__classPrivateFieldSet || function (receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value), value;\n};\nvar __classPrivateFieldGet = this && this.__classPrivateFieldGet || function (receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\nvar _FallbackHandlerManager_ethAdapter, _FallbackHandlerManager_safeContract, _FallbackHandlerManager_slot;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nconst safe_core_sdk_utils_1 = require(\"@safe-global/safe-core-sdk-utils\");\nconst utils_1 = require(\"../utils\");\nconst constants_1 = require(\"../utils/constants\");\nclass FallbackHandlerManager {\n  constructor(ethAdapter, safeContract) {\n    _FallbackHandlerManager_ethAdapter.set(this, void 0);\n    _FallbackHandlerManager_safeContract.set(this, void 0);\n    // keccak256(\"fallback_manager.handler.address\")\n    _FallbackHandlerManager_slot.set(this, '0x6c9a6c4a39284e37ed1cf53d337577d14212a4870fb976a4366c693b939918d5');\n    __classPrivateFieldSet(this, _FallbackHandlerManager_ethAdapter, ethAdapter, \"f\");\n    __classPrivateFieldSet(this, _FallbackHandlerManager_safeContract, safeContract, \"f\");\n  }\n  validateFallbackHandlerAddress(fallbackHandlerAddress) {\n    const isValidAddress = __classPrivateFieldGet(this, _FallbackHandlerManager_ethAdapter, \"f\").isAddress(fallbackHandlerAddress);\n    if (!isValidAddress || (0, utils_1.isZeroAddress)(fallbackHandlerAddress)) {\n      throw new Error('Invalid fallback handler address provided');\n    }\n  }\n  validateFallbackHandlerIsNotEnabled(currentFallbackHandler, newFallbackHandlerAddress) {\n    if ((0, utils_1.sameString)(currentFallbackHandler, newFallbackHandlerAddress)) {\n      throw new Error('Fallback handler provided is already enabled');\n    }\n  }\n  validateFallbackHandlerIsEnabled(fallbackHandlerAddress) {\n    if ((0, utils_1.isZeroAddress)(fallbackHandlerAddress)) {\n      throw new Error('There is no fallback handler enabled yet');\n    }\n  }\n  async getFallbackHandler() {\n    const safeVersion = await __classPrivateFieldGet(this, _FallbackHandlerManager_safeContract, \"f\").getVersion();\n    if ((0, safe_core_sdk_utils_1.hasSafeFeature)(safe_core_sdk_utils_1.SAFE_FEATURES.SAFE_FALLBACK_HANDLER, safeVersion)) {\n      return __classPrivateFieldGet(this, _FallbackHandlerManager_ethAdapter, \"f\").getStorageAt(__classPrivateFieldGet(this, _FallbackHandlerManager_safeContract, \"f\").getAddress(), __classPrivateFieldGet(this, _FallbackHandlerManager_slot, \"f\"));\n    } else {\n      throw new Error('Current version of the Safe does not support the fallback handler functionality');\n    }\n  }\n  async encodeEnableFallbackHandlerData(fallbackHandlerAddress) {\n    this.validateFallbackHandlerAddress(fallbackHandlerAddress);\n    const currentFallbackHandler = await this.getFallbackHandler();\n    this.validateFallbackHandlerIsNotEnabled(currentFallbackHandler, fallbackHandlerAddress);\n    return __classPrivateFieldGet(this, _FallbackHandlerManager_safeContract, \"f\").encode('setFallbackHandler', [fallbackHandlerAddress]);\n  }\n  async encodeDisableFallbackHandlerData() {\n    const currentFallbackHandler = await this.getFallbackHandler();\n    this.validateFallbackHandlerIsEnabled(currentFallbackHandler);\n    return __classPrivateFieldGet(this, _FallbackHandlerManager_safeContract, \"f\").encode('setFallbackHandler', [constants_1.ZERO_ADDRESS]);\n  }\n}\n_FallbackHandlerManager_ethAdapter = new WeakMap(), _FallbackHandlerManager_safeContract = new WeakMap(), _FallbackHandlerManager_slot = new WeakMap();\nexports.default = FallbackHandlerManager;","map":{"version":3,"names":["safe_core_sdk_utils_1","require","utils_1","constants_1","FallbackHandlerManager","constructor","ethAdapter","safeContract","_FallbackHandlerManager_ethAdapter","set","_FallbackHandlerManager_safeContract","_FallbackHandlerManager_slot","__classPrivateFieldSet","validateFallbackHandlerAddress","fallbackHandlerAddress","isValidAddress","__classPrivateFieldGet","isAddress","isZeroAddress","Error","validateFallbackHandlerIsNotEnabled","currentFallbackHandler","newFallbackHandlerAddress","sameString","validateFallbackHandlerIsEnabled","getFallbackHandler","safeVersion","getVersion","hasSafeFeature","SAFE_FEATURES","SAFE_FALLBACK_HANDLER","getStorageAt","getAddress","encodeEnableFallbackHandlerData","encode","encodeDisableFallbackHandlerData","ZERO_ADDRESS","exports","default"],"sources":["../../../src/managers/fallbackHandlerManager.ts"],"sourcesContent":[null],"mappings":";;;;;;;;;;;;;;;;;AACA,MAAAA,qBAAA,GAAAC,OAAA;AACA,MAAAC,OAAA,GAAAD,OAAA;AACA,MAAAE,WAAA,GAAAF,OAAA;AAEA,MAAMG,sBAAsB;EAM1BC,YAAYC,UAAsB,EAAEC,YAAgC;IALpEC,kCAAA,CAAAC,GAAA;IACAC,oCAAA,CAAAD,GAAA;IACA;IACAE,4BAAA,CAAAF,GAAA,OAAQ,oEAAoE;IAG1EG,sBAAA,KAAI,EAAAJ,kCAAA,EAAeF,UAAU;IAC7BM,sBAAA,KAAI,EAAAF,oCAAA,EAAiBH,YAAY;EACnC;EAEQM,8BAA8BA,CAACC,sBAA8B;IACnE,MAAMC,cAAc,GAAGC,sBAAA,KAAI,EAAAR,kCAAA,MAAY,CAACS,SAAS,CAACH,sBAAsB,CAAC;IACzE,IAAI,CAACC,cAAc,IAAI,IAAAb,OAAA,CAAAgB,aAAa,EAACJ,sBAAsB,CAAC,EAAE;MAC5D,MAAM,IAAIK,KAAK,CAAC,2CAA2C,CAAC;;EAEhE;EAEQC,mCAAmCA,CACzCC,sBAA8B,EAC9BC,yBAAiC;IAEjC,IAAI,IAAApB,OAAA,CAAAqB,UAAU,EAACF,sBAAsB,EAAEC,yBAAyB,CAAC,EAAE;MACjE,MAAM,IAAIH,KAAK,CAAC,8CAA8C,CAAC;;EAEnE;EAEQK,gCAAgCA,CAACV,sBAA8B;IACrE,IAAI,IAAAZ,OAAA,CAAAgB,aAAa,EAACJ,sBAAsB,CAAC,EAAE;MACzC,MAAM,IAAIK,KAAK,CAAC,0CAA0C,CAAC;;EAE/D;EAEA,MAAMM,kBAAkBA,CAAA;IACtB,MAAMC,WAAW,GAAG,MAAMV,sBAAA,KAAI,EAAAN,oCAAA,MAAc,CAACiB,UAAU,EAAE;IACzD,IAAI,IAAA3B,qBAAA,CAAA4B,cAAc,EAAC5B,qBAAA,CAAA6B,aAAa,CAACC,qBAAqB,EAAEJ,WAAW,CAAC,EAAE;MACpE,OAAOV,sBAAA,KAAI,EAAAR,kCAAA,MAAY,CAACuB,YAAY,CAACf,sBAAA,KAAI,EAAAN,oCAAA,MAAc,CAACsB,UAAU,EAAE,EAAEhB,sBAAA,KAAI,EAAAL,4BAAA,MAAM,CAAC;KAClF,MAAM;MACL,MAAM,IAAIQ,KAAK,CACb,iFAAiF,CAClF;;EAEL;EAEA,MAAMc,+BAA+BA,CAACnB,sBAA8B;IAClE,IAAI,CAACD,8BAA8B,CAACC,sBAAsB,CAAC;IAC3D,MAAMO,sBAAsB,GAAG,MAAM,IAAI,CAACI,kBAAkB,EAAE;IAC9D,IAAI,CAACL,mCAAmC,CAACC,sBAAsB,EAAEP,sBAAsB,CAAC;IACxF,OAAOE,sBAAA,KAAI,EAAAN,oCAAA,MAAc,CAACwB,MAAM,CAAC,oBAAoB,EAAE,CAACpB,sBAAsB,CAAC,CAAC;EAClF;EAEA,MAAMqB,gCAAgCA,CAAA;IACpC,MAAMd,sBAAsB,GAAG,MAAM,IAAI,CAACI,kBAAkB,EAAE;IAC9D,IAAI,CAACD,gCAAgC,CAACH,sBAAsB,CAAC;IAC7D,OAAOL,sBAAA,KAAI,EAAAN,oCAAA,MAAc,CAACwB,MAAM,CAAC,oBAAoB,EAAE,CAAC/B,WAAA,CAAAiC,YAAY,CAAC,CAAC;EACxE;;;AAGFC,OAAA,CAAAC,OAAA,GAAelC,sBAAsB"},"metadata":{},"sourceType":"script","externalDependencies":[]}