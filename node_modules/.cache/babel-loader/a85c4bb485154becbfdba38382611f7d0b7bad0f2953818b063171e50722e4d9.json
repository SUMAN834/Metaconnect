{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.encodeMultiSendData = exports.standardizeSafeTransactionData = exports.standardizeMetaTransactionData = void 0;\nconst bytes_1 = require(\"@ethersproject/bytes\");\nconst solidity_1 = require(\"@ethersproject/solidity\");\nconst safe_core_sdk_types_1 = require(\"@safe-global/safe-core-sdk-types\");\nconst safe_core_sdk_utils_1 = require(\"@safe-global/safe-core-sdk-utils\");\nconst constants_1 = require(\"../constants\");\nconst gas_1 = require(\"./gas\");\nfunction standardizeMetaTransactionData(tx) {\n  var _a;\n  const standardizedTxs = {\n    ...tx,\n    operation: (_a = tx.operation) !== null && _a !== void 0 ? _a : safe_core_sdk_types_1.OperationType.Call\n  };\n  return standardizedTxs;\n}\nexports.standardizeMetaTransactionData = standardizeMetaTransactionData;\nasync function standardizeSafeTransactionData(safeContract, ethAdapter, tx) {\n  var _a, _b, _c, _d;\n  const standardizedTxs = {\n    to: tx.to,\n    value: tx.value,\n    data: tx.data,\n    operation: (_a = tx.operation) !== null && _a !== void 0 ? _a : safe_core_sdk_types_1.OperationType.Call,\n    baseGas: (_b = tx.baseGas) !== null && _b !== void 0 ? _b : 0,\n    gasPrice: (_c = tx.gasPrice) !== null && _c !== void 0 ? _c : 0,\n    gasToken: tx.gasToken || constants_1.ZERO_ADDRESS,\n    refundReceiver: tx.refundReceiver || constants_1.ZERO_ADDRESS,\n    nonce: (_d = tx.nonce) !== null && _d !== void 0 ? _d : await safeContract.getNonce()\n  };\n  let safeTxGas;\n  if (typeof tx.safeTxGas !== 'undefined') {\n    return {\n      ...standardizedTxs,\n      safeTxGas: tx.safeTxGas\n    };\n  }\n  const safeVersion = await safeContract.getVersion();\n  if ((0, safe_core_sdk_utils_1.hasSafeFeature)(safe_core_sdk_utils_1.SAFE_FEATURES.SAFE_TX_GAS_OPTIONAL, safeVersion) && standardizedTxs.gasPrice === 0) {\n    safeTxGas = 0;\n  } else {\n    safeTxGas = await (0, gas_1.estimateTxGas)(safeContract, ethAdapter, standardizedTxs.to, standardizedTxs.value, standardizedTxs.data, standardizedTxs.operation);\n  }\n  return {\n    ...standardizedTxs,\n    safeTxGas\n  };\n}\nexports.standardizeSafeTransactionData = standardizeSafeTransactionData;\nfunction encodeMetaTransaction(tx) {\n  const data = (0, bytes_1.arrayify)(tx.data);\n  const encoded = (0, solidity_1.pack)(['uint8', 'address', 'uint256', 'uint256', 'bytes'], [tx.operation, tx.to, tx.value, data.length, data]);\n  return encoded.slice(2);\n}\nfunction encodeMultiSendData(txs) {\n  return '0x' + txs.map(tx => encodeMetaTransaction(tx)).join('');\n}\nexports.encodeMultiSendData = encodeMultiSendData;","map":{"version":3,"names":["bytes_1","require","solidity_1","safe_core_sdk_types_1","safe_core_sdk_utils_1","constants_1","gas_1","standardizeMetaTransactionData","tx","standardizedTxs","operation","_a","OperationType","Call","exports","standardizeSafeTransactionData","safeContract","ethAdapter","to","value","data","baseGas","_b","gasPrice","_c","gasToken","ZERO_ADDRESS","refundReceiver","nonce","_d","getNonce","safeTxGas","safeVersion","getVersion","hasSafeFeature","SAFE_FEATURES","SAFE_TX_GAS_OPTIONAL","estimateTxGas","encodeMetaTransaction","arrayify","encoded","pack","length","slice","encodeMultiSendData","txs","map","join"],"sources":["../../../../src/utils/transactions/utils.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}